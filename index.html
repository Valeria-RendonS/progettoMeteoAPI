<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meteo Globale - Home</title>
    <style>
        :root {
            --sky-top: #4facfe;
            --sky-bottom: #00f2fe;
            --sun-color: #ffd700;
            --hill-back: #2ecc71;
            --hill-front: #27ae60;
            --card-bg: rgba(255, 255, 255, 0.75);
            --accent: #1e3c72;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', sans-serif; }
        body { height: 100vh; overflow: hidden; display: flex; justify-content: center; align-items: center; background: #333; }

        .viewport { position: relative; width: 100%; height: 100%; background: linear-gradient(to bottom, var(--sky-top), var(--sky-bottom)); overflow: hidden; }

        /* PAESAGGIO */
        .sun { position: absolute; top: 5%; right: 5%; width: 80px; height: 80px; background: var(--sun-color); border-radius: 50%; box-shadow: 0 0 40px var(--sun-color); animation: pulse 4s infinite alternate; }
        .landscape { position: absolute; bottom: 0; width: 100%; height: 45%; }
        .hill { position: absolute; border-radius: 100% 100% 0 0; }
        .bg-hill { width: 120%; height: 60%; bottom: 0; left: -10%; background: var(--hill-back); z-index: 1; }
        .fg-hill { width: 120%; height: 40%; bottom: -20px; right: -10%; background: var(--hill-front); z-index: 2; }

        /* INTERFACCIA RICERCA */
        .weather-overlay {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 90%; max-width: 800px; background: var(--card-bg);
            backdrop-filter: blur(15px); padding: 2.5rem; border-radius: 30px;
            box-shadow: 0 15px 50px rgba(0,0,0,0.2); z-index: 10;
        }

        .header-box { text-align: center; margin-bottom: 25px; color: var(--accent); }
        .header-box h1 { font-size: 2.5rem; margin-bottom: 5px; }

        .search-container { display: flex; flex-direction: column; gap: 15px; margin-bottom: 30px; align-items: center; }
        .search-row { display: flex; gap: 10px; width: 100%; max-width: 600px; }

        input {
            flex: 1; padding: 15px 20px; border-radius: 25px; border: 2px solid transparent;
            outline: none; font-size: 1rem; box-shadow: 0 4px 10px rgba(0,0,0,0.1); transition: 0.3s;
        }
        input:focus { border-color: var(--sky-top); background: white; }

        .btn-go {
            padding: 15px 40px; border-radius: 25px; border: none; background: var(--accent);
            color: white; font-weight: bold; cursor: pointer; transition: 0.3s;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2); font-size: 1.1rem;
        }
        .btn-go:hover { transform: translateY(-2px); background: #2a5298; }

        .weather-grid { display: grid; grid-template-columns: 1fr 2fr; gap: 20px; align-items: center; border-top: 1px solid rgba(0,0,0,0.1); padding-top: 20px; }
        .current-weather { text-align: center; border-right: 1px solid rgba(0,0,0,0.1); padding-right: 15px; }
        .temp-main { font-size: 3rem; font-weight: 800; color: var(--accent); }
        
        .forecast-container { display: flex; gap: 10px; overflow-x: auto; padding: 5px 0; }
        .forecast-item {
            background: rgba(255,255,255,0.5); padding: 10px; border-radius: 12px;
            min-width: 80px; text-align: center; cursor: pointer; transition: 0.3s;
        }

        /* STILE RANA */
        .frog {
            position: absolute;
            font-size: 3rem;
            z-index: 100;
            cursor: grab;
            user-select: none;
            will-change: transform, left, top;
            filter: drop-shadow(0 5px 10px rgba(0,0,0,0.2));
            transition: transform 0.2s ease-out;
        }

        @keyframes pulse { from { transform: scale(1); } to { transform: scale(1.1); } }
        @media (max-width: 650px) { 
            .weather-grid { grid-template-columns: 1fr; }
            .current-weather { border-right: none; border-bottom: 1px solid rgba(0,0,0,0.1); padding-bottom: 15px; }
            .search-row { flex-direction: column; }
        }
    </style>
</head>
<body>
    <div class="viewport" id="viewport">
        <div class="sun"></div>
        <div class="landscape">
            <div class="hill bg-hill"></div>
            <div class="hill fg-hill"></div>
        </div>

        <div class="frog" id="frog">üê∏</div>

        <div class="weather-overlay">
            <div class="header-box">
                <h1>Meteo Pro</h1>
                <p>Prova a prendere la rana o cerca una citt√†!</p>
            </div>

            <div class="search-container">
                <div class="search-row">
                    <input type="text" id="countryInput" list="countriesList" placeholder="Caricamento paesi...">
                    <datalist id="countriesList"></datalist>
                    <input type="text" id="cityInput" list="citiesList" placeholder="Poi scegli la citt√†...">
                    <datalist id="citiesList"></datalist>
                </div>
                <button class="btn-go" onclick="goToDetails()">VAI AL METEO</button>
            </div>

            <div class="weather-grid">
                <div class="current-weather">
                    <div class="temp-main">22¬∞C</div>
                    <p>Oggi</p>
                </div>
                <div class="forecast-container" id="forecastList"></div>
            </div>
        </div>
    </div>

    <script>
        // --- LOGICA MOVIMENTO RANA ---
        const frog = document.getElementById('frog');
        const viewport = document.getElementById('viewport');
        
        let posX = window.innerWidth / 2;
        let posY = window.innerHeight - 100;
        let targetX = posX;
        let targetY = posY;
        let velX = 0;
        let velY = 0;
        let isDashing = false;

        // Parametri configurabili
        const friction = 0.92;      // Attrito per lo scatto (pi√π basso = scatto pi√π breve)
        const wanderSpeed = 0.02;   // Velocit√† del movimento lento casuale
        const dashForce = 15;       // Forza della spinta quando il mouse si avvicina

        function initFrog() {
            // Aggiorna posizione fisica
            posX += velX;
            posY += velY;

            if (!isDashing) {
                // Movimento lento verso il target casuale
                posX += (targetX - posX) * wanderSpeed;
                posY += (targetY - posY) * wanderSpeed;
                
                // Attrito per fermare scatti precedenti
                velX *= friction;
                velY *= friction;
            } else {
                // Durante lo scatto usiamo la velocit√† pura
                velX *= friction;
                velY *= friction;
                
                // Se la velocit√† scende sotto una soglia, torna a muoversi lentamente
                if (Math.abs(velX) < 0.5 && Math.abs(velY) < 0.5) {
                    isDashing = false;
                    setNewWanderTarget();
                }
            }

            // Limiti bordi schermo
            if (posX < 0) posX = 0;
            if (posX > window.innerWidth - 50) posX = window.innerWidth - 50;
            if (posY < 0) posY = 0;
            if (posY > window.innerHeight - 50) posY = window.innerHeight - 50;

            frog.style.left = `${posX}px`;
            frog.style.top = `${posY}px`;

            // Rotazione basata sulla direzione
            const angle = Math.atan2(velY, velX) * (180 / Math.PI);
            if (Math.abs(velX) > 0.1) {
                frog.style.transform = `rotate(${angle + 90}deg)`;
            }

            requestAnimationFrame(initFrog);
        }

        function setNewWanderTarget() {
            if (!isDashing) {
                targetX = Math.random() * (window.innerWidth - 100);
                targetY = Math.random() * (window.innerHeight - 100);
            }
            // Cambia obiettivo casuale ogni 2-4 secondi
            setTimeout(setNewWanderTarget, Math.random() * 2000 + 2000);
        }

        // Rilevamento cursore per "Scatto di allontanamento"
        document.addEventListener('mousemove', (e) => {
            const dx = posX + 25 - e.clientX;
            const dy = posY + 25 - e.clientY;
            const distance = Math.sqrt(dx * dx + dy * dy);

            // Se il mouse √® vicino (meno di 120px)
            if (distance < 120) {
                isDashing = true;
                // Calcola vettore di fuga
                const force = (120 - distance) / 120;
                velX += (dx / distance) * force * dashForce;
                velY += (dy / distance) * force * dashForce;
            }
        });

        // --- LOGICA METEO E API (Tua logica originale) ---
        let globalLocations = [];
        const fallbackLocations = [
            { country: "Italia", cities: ["Roma", "Milano", "Napoli"] },
            { country: "France", cities: ["Paris", "Lyon"] }
        ];

        async function fetchCountries() {
            try {
                const response = await fetch('https://countriesnow.space/api/v0.1/countries');
                const data = await response.json();
                globalLocations = !data.error ? data.data : fallbackLocations;
            } catch (error) {
                globalLocations = fallbackLocations;
            }
            populateCountryList();
            document.getElementById('countryInput').placeholder = "Nazione (es. Italy)";
        }

        function populateCountryList() {
            const list = document.getElementById('countriesList');
            globalLocations.sort((a, b) => a.country.localeCompare(b.country));
            globalLocations.forEach(item => {
                const opt = document.createElement('option');
                opt.value = item.country;
                list.appendChild(opt);
            });
        }

        document.getElementById('countryInput').addEventListener('input', function() {
            const cityList = document.getElementById('citiesList');
            const cityInput = document.getElementById('cityInput');
            cityList.innerHTML = "";
            const found = globalLocations.find(c => c.country.toLowerCase() === this.value.toLowerCase());
            if (found) {
                found.cities.forEach(city => {
                    const opt = document.createElement('option');
                    opt.value = city;
                    cityList.appendChild(opt);
                });
            }
        });

        function goToDetails(customTemp = null) {
            const city = document.getElementById('cityInput').value;
            if(!city) { alert("Scegli una citt√†!"); return; }
            localStorage.setItem("selectedDay", JSON.stringify({ city: city, temp: customTemp || 22 }));
            window.location.href = "pagina.html";
        }

        window.onload = () => {
            fetchCountries();
            setNewWanderTarget();
            initFrog(); // Avvia l'animazione della rana
            
            const weekData = [
                { d: "Lun", t: 22, icon: "‚òÄÔ∏è" }, { d: "Mar", t: 18, icon: "‚òÅÔ∏è" },
                { d: "Mer", t: 15, icon: "üåßÔ∏è" }, { d: "Gio", t: 27, icon: "‚òÄÔ∏è" }
            ];
            const list = document.getElementById('forecastList');
            weekData.forEach(item => {
                const card = document.createElement('div');
                card.className = 'forecast-item';
                card.innerHTML = `<b>${item.d}</b><br>${item.icon}<br><b>${item.t}¬∞</b>`;
                card.onclick = () => goToDetails(item.t);
                list.appendChild(card);
            });
        };
    </script>
</body>
</html>